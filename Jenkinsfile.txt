node{
stage('git checkout'){
    git credentialsId: 'gitlogin', url: 'https://github.com/bakyatcs/PCF'
    
}
stage('maven code build & test'){

def mavenLocal = tool name : 'maven-3.0' , type: 'maven'
def mavenCommand = "${mavenLocal}/bin/mvn"
sh "${mavenCommand} clean package"
}
stage('build docker image'){

sh 'docker build -t bakyamech/jenkins-build:1.0 .'
}
stage('push docker image'){
withCredentials([string(credentialsId: 'dockerhub1', variable: 'dockerLogin')]) {
sh "docker login -u bakyamech -p ${dockerLogin}"
}

sh 'docker push bakyamech/jenkins-build:1.0'
}
stage('deploy to PCF'){

pushToCloudFoundry cloudSpace: 'development', credentialsId: 'PCFLogin', manifestChoice: [appName: 'PipelineProject', appPath: '', buildpack: '', command: '', domain: '', hostname: 'PipelineProject', instances: '1', memory: '512', noRoute: 'false', stack: '', timeout: '60', value: 'jenkinsConfig'], organization: 'bakyatcs', target: 'http://cfapps.io'


}
}